{% load static %}
<!doctype html>
<html lang="fa">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>WP-Project | ุชุญููุงุช ู ุจุงุฒุฌู</title>
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com"> -->
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="{% static 'demo/styles.css' %}" />
    <style>
      .board-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        background: #2c3e50; /* Darker background for contrast */
        padding: 30px;
        border-radius: 16px;
        min-height: 500px;
        margin-top: 20px;
        border: 3px solid #34495e;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        position: relative; /* Required for SVG overlay */
        overflow: visible;
      }
      #boardSvg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* Let clicks pass through to items */
        z-index: 1;
      }
      .board-item {
        background: #fff;
        padding: 8px;
        border-radius: 4px; /* More like a photo/card */
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        width: 120px;
        height : 120px;
        text-align: center;
        position: relative;
        color: #2c3e50;
        transform: rotate(-1deg); /* Slight tilt for "board" feel */
        transition: transform 0.2s;
        z-index: 2; /* Above SVG lines */
      }
      .board-item:nth-child(even) {
        transform: rotate(1.5deg);
      }
      .board-item:hover {
        transform: scale(1.05) rotate(0deg);
        z-index: 10;
      }
      .board-item.evidence { border-top: 6px solid #3498db; }
      .board-item.suspect { border-top: 6px solid #e74c3c; }
      .connection-line {
        margin-top: 10px;
        font-size: 0.8em;
        color: #666;
        border-top: 1px solid #eee;
        padding-top: 5px;
      }
    </style>
  </head>
  <body dir="rtl">
    <main class="landing">
      <section class="card">
        <div class="panel-header">
          <h1>ุชุญููุงุช ู ุจุงุฒุฌู</h1>
          <div style="display: flex; gap: 8px; align-items: center;">
            <a href="/dashboard/" class="ghost">ุจุงุฒฺฏุดุช</a>
            <button id="logoutBtn" class="button ghost">ุฎุฑูุฌ</button>
          </div>
        </div>

        <div id="investigationArea">
          <div class="panel-header" style="margin-top:10px;">
            <h2 style="margin:0;">ุงูุชุฎุงุจ ูพุฑููุฏู</h2>
          </div>
          <select id="caseSelect" class="full" style="margin-top:10px; padding: 8px; border-radius: 8px;">
            <option value="">ฺฉ ูพุฑููุฏู ุงูุชุฎุงุจ ฺฉูุฏ...</option>
          </select>

          <div id="caseContent" style="display:none; margin-top:20px;">
            <!-- Case Resolution Panel (Section 4.4: ุญู ูพุฑููุฏู) -->
            <div id="resolutionPanel" class="panel" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; margin-bottom: 20px; border-radius: 10px; display: none; border-left: 5px solid #3498db;">
              <h3 style="margin-top:0; color:#ecf0f1;">๐ ูุถุนุช ูพุฑููุฏู: <span id="caseStatusText" style="color:#3498db; font-weight:bold;">-</span></h3>
              
              <!-- Detective Actions (Step 1) -->
              <div id="detectiveActions" style="display:none; background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; margin-bottom:10px;">
                <h4 style="margin:0 0 10px 0; color:#ecf0f1;">๐ ฺฏุงู ฑ: ฺฉุงุฑุขฺฏุงู - ุงุฑุณุงู ุจุฑุง ุญู ูพุฑููุฏู</h4>
                <p style="margin:0 0 10px 0; font-size:0.95em;">ูพุณ ุงุฒ ุฌูุนโุขูุฑ ุชูุงู ุดูุงูุฏ ู ุดูุงุณุง ูุชููู ุงุตูุ ูพุฑููุฏู ุฑุง ุจุฑุง ุจุฑุฑุณ ฺฏุฑููุจุงู ุงุฑุณุงู ฺฉูุฏ.</p>
                <button id="btnSubmitResolution" class="button" style="background:#3498db; width:100%; font-weight:bold; padding:10px;">ุงุฑุณุงู ุจุฑุง ุญู ูพุฑููุฏู</button>
              </div>
              
              <!-- Sergeant Actions (Step 2) -->
              <div id="sergeantActions" style="display:none; background:rgba(255,255,255,0.1); padding:15px; border-radius:8px; margin-bottom:10px;">
                <h4 style="margin:0 0 10px 0; color:#ecf0f1;">๐ฎ ฺฏุงู ฒ: ฺฏุฑููุจุงู - ุจุฑุฑุณ ู ุชุงุฏ</h4>
                <p style="margin:0 0 10px 0; font-size:0.95em;">ุดูุงูุฏ ู ูุชููู ุฑุง ุจุฑุฑุณ ฺฉูุฏ. ุฏุฑ ุตูุฑุช ุชุงุฏ:</p>
                <ul style="margin:0 0 10px 0; padding-left:20px; font-size:0.9em;">
                  <li>ุงฺฏุฑ ุฌุฑู <strong>ุจุญุฑุงู</strong> ุงุณุช: ุจู ุฑุฆุณ ูพูุณ ุงุฑุณุงู ูโุดูุฏ</li>
                  <li>ุงฺฏุฑ ุฌุฑู <strong>ุนุงุฏ</strong> ุงุณุช: ูพุฑููุฏู ูุฎุชููู ูโุดูุฏ</li>
                </ul>
                <textarea id="sergeantNotes" placeholder="ุงุฏุฏุงุดุชโูุง ุจุฑุฑุณ..." style="width:100%; margin-bottom:10px; color: black; padding:8px; border-radius:4px; min-height:80px;"></textarea>
                <div style="display:flex; gap:10px;">
                  <button id="btnApproveSergeant" class="button" style="background:#27ae60; flex:1; font-weight:bold;">โ ุชุงุฏ</button>
                  <button id="btnRejectSergeant" class="button" style="background:#e74c3c; flex:1; font-weight:bold;">โ ุฑุฏ (ุจุงุฒฺฏุดุช)</button>
                </div>
              </div>
              
              <!-- Chief Actions (Step 3) -->
              <div id="chiefActions" style="display:none; background:rgba(255,255,255,0.1); padding:15px; border-radius:8px;">
                <h4 style="margin:0 0 10px 0; color:#ecf0f1;">๐ ฺฏุงู ณ: ุฑุฆุณ ูพูุณ - ุชุงุฏ ููุง (ุฌุฑุงุฆู ุจุญุฑุงู)</h4>
                <p style="margin:0 0 10px 0; font-size:0.95em;">ุงู ูพุฑููุฏู ุจู ุฏูู <strong>ุณุทุญ ุจุญุฑุงู</strong> ูุงุฒ ุจู ุชุงุฏ ููุง ุดูุง ุฏุงุฑุฏ.</p>
                <div style="display:flex; gap:10px;">
                  <button id="btnApproveChief" class="button" style="background:#27ae60; flex:1; font-weight:bold;">โ ุชุงุฏ ููุง</button>
                  <button id="btnRejectChief" class="button" style="background:#e74c3c; flex:1; font-weight:bold;">โ ุฑุฏ (ุจุงุฒฺฏุดุช)</button>
                </div>
              </div>
            </div>

            <div class="tabs" style="display:flex; gap:10px; margin-bottom:20px;">
              <button class="tab-btn active" data-tab="suspectsTab">ูุชููู ู ุจุงุฒุฌู</button>
              <button class="tab-btn" data-tab="evidenceTab">ุดูุงูุฏ ู ูุฏุงุฑฺฉ</button>
              <button class="tab-btn" data-tab="boardTab">ุชุฎุชู ฺฉุงุฑุขฺฏุงู</button>
            </div>

            <!-- Suspects Tab (Section 5.4: ุดูุงุณุง ูุชููู ู ุจุงุฒุฌู) -->
            <div id="suspectsTab" class="tab-content">
              <h3 style="color:#2c3e50; border-bottom:3px solid #e74c3c; padding-bottom:10px;">๐ฅ ูุฏุฑุช ูุชููู (Section 5.4)</h3>
              <div class="panel" style="background:#f9f9f9; padding:15px; margin-bottom:20px; border-radius:8px; border-left:4px solid #3498db;">
                <h4 style="margin-top:0; color:#2c3e50;">ุงูุฒูุฏู ูุชูู ุฌุฏุฏ</h4>
                <form id="addSuspectForm" class="form-grid">
                  <input name="name" placeholder="ูุงู ฺฉุงูู ูุชูู" required style="padding:8px; border:1px solid #bdc3c7; border-radius:4px;" />
                  <input name="details" placeholder="ุฌุฒุฆุงุช ู ุงุทูุงุนุงุช" required style="padding:8px; border:1px solid #bdc3c7; border-radius:4px;" />
                  <label style="display:flex; align-items:center; gap:8px; color:#2c3e50;">
                    <input type="checkbox" name="is_main_suspect" style="width:16px; height:16px; cursor:pointer;"> 
                    <span style="font-weight:bold;">๐ฏ ูุชูู ุงุตู</span>
                  </label>
                  <button type="submit" class="button" style="background:#3498db; font-weight:bold;">+ ุงูุฒูุฏู ูุชูู</button>
                </form>
              </div>
              <h4 style="color:#2c3e50; margin-bottom:10px;">ูุชููู ุงู ูพุฑููุฏู:</h4>
              <ul id="suspectsList" style="margin:0; padding:0; list-style:none;"></ul>

              <div id="interrogationArea" style="display:none; margin-top:20px; padding:20px; background:linear-gradient(135deg, #ecf0f1 0%, #f5f7fa 100%); border-radius:10px; border-left: 4px solid #e74c3c;">
                <h3 style="margin-top:0; color:#2c3e50;">๐ค ุซุจุช ุจุงุฒุฌู (Section 5.4)</h3>
                <p style="margin:0 0 10px 0; color:#555; font-size:0.9em;"><strong>ูุชูู:</strong> <span id="currentSuspectName" style="color:#e74c3c; font-weight:bold;"></span></p>
                <form id="addInterrogationForm" class="form-grid">
                  <textarea name="transcript" placeholder="ูุชู ฺฉุงูู ุจุงุฒุฌู..." class="full" required style="min-height:100px; padding:8px; border:1px solid #bdc3c7; border-radius:4px; color:#2c3e50;"></textarea>
                  <div style="display:flex; gap:10px; align-items:center;">
                    <div style="flex:1;">
                      <label style="display:block; margin-bottom:5px; color:#2c3e50; font-weight:bold;">ุงูุชุงุฒ ฺฉุงุฑุขฺฏุงู (ฑ-ฑฐ):</label>
                      <input type="number" name="score" placeholder="ุงูุชุงุฒ" min="1" max="10" required style="width:100%; padding:8px; border:1px solid #bdc3c7; border-radius:4px; color:#2c3e50;" />
                    </div>
                    <button type="submit" class="button" style="background:#3498db; margin-top:22px; padding:8px 15px;">ุซุจุช</button>
                  </div>
                </form>
                <div style="margin-top:20px;">
                  <h4 style="color:#2c3e50; margin-bottom:10px; border-bottom:2px solid #3498db; padding-bottom:5px;">๐ ุชุงุฑุฎฺู ุจุงุฒุฌูโูุง</h4>
                  <p style="color:#7f8c8d; font-size:0.9em; margin-bottom:10px;">ุชูุถุญ: ฺฉุงุฑุขฺฏุงู ุงูุชุงุฒ ุงููู ุซุจุช ูโฺฉูุฏ. ุณูพุณ <strong>ฺฉุงูพุชุงู</strong> ุงูุชุงุฒ ููุง ุฑุง ุชุงุฏ ูโฺฉูุฏ.</p>
                  <ul id="interrogationsList" style="margin:0; padding:0; list-style:none;"></ul>
                </div>
              </div>
            </div>

            <!-- Evidence Tab (Section 4.3: ุดูุงูุฏ ู ูุฏุงุฑฺฉ) -->
            <div id="evidenceTab" class="tab-content" style="display:none;">
              <h3 style="color:#2c3e50; border-bottom:3px solid #3498db; padding-bottom:10px;">๐ ุดูุงูุฏ ู ูุฏุงุฑฺฉ (Section 4.3)</h3>
              
              <div class="panel" style="padding:15px; margin-bottom:20px;">
                <h4>ููุน ูุฏุฑฺฉ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:</h4>
                <select id="evidenceTypeSelect" class="full" style="margin-bottom:15px; padding:8px;">
                  <option value="witness">ุงุณุชุดูุงุฏ ุดุงูุฏุงู (1.3.4)</option>
                  <option value="biological">ุดูุงูุฏ ุฒุณุช ู ูพุฒุดฺฉ (2.3.4)</option>
                  <option value="vehicle">ุดูุงูุฏ ูุณุงู ูููู (3.3.4)</option>
                  <option value="id_doc">ูุฏุงุฑฺฉ ุดูุงุณุง (4.3.4)</option>
                  <option value="other">ุณุงุฑ ููุงุฑุฏ (5.3.4)</option>
                </select>

                <!-- Common Fields -->
                <form id="addEvidenceForm" class="form-grid">
                  <input name="title" placeholder="ุนููุงู ูุฏุฑฺฉ" required />
                  <input name="description" placeholder="ุชูุถุญุงุช ฺฉู" required />
                  
                  <!-- Witness Fields -->
                  <div id="witnessFields" class="full evidence-fields">
                    <textarea name="transcript" placeholder="ุฑูููุดุช ุตุญุจุชโูุง ุดุงูุฏ" style="width:100%; min-height:80px;"></textarea>
                  </div>

                  <!-- Biological Fields -->
                  <div id="biologicalFields" class="full evidence-fields" style="display:none;">
                    <label><input type="checkbox" name="is_verified"> ุชุงุฏ ุดุฏู ุชูุณุท ุขุฒูุงุดฺฏุงู</label>
                    <input name="medical_follow_up" placeholder="ูุชุฌู ูพฺฏุฑ ูพุฒุดฺฉ" />
                  </div>

                  <!-- Vehicle Fields -->
                  <div id="vehicleFields" class="full evidence-fields" style="display:none;">
                    <input name="model_name" placeholder="ูุฏู ุฎูุฏุฑู" />
                    <input name="color" placeholder="ุฑูฺฏ" />
                    <input name="license_plate" placeholder="ุดูุงุฑู ูพูุงฺฉ" />
                    <input name="serial_number" placeholder="ุดูุงุฑู ุณุฑุงู (ุงฺฏุฑ ูพูุงฺฉ ูุฏุงุฑุฏ)" />
                  </div>

                  <!-- ID Doc Fields -->
                  <div id="idDocFields" class="full evidence-fields" style="display:none;">
                    <input name="owner_full_name" placeholder="ูุงู ฺฉุงูู ุตุงุญุจ ูุฏุฑฺฉ" />
                    <textarea name="extra_info_json" placeholder='ุงุทูุงุนุงุช ุชฺฉูู (JSON) - ูุซุงู: {"age": 30}' style="width:100%;"></textarea>
                  </div>

                  <button type="submit" class="full">ุซุจุช ูุฏุฑฺฉ</button>
                </form>
              </div>

              <ul id="evidenceList" style="margin-top:15px;"></ul>
            </div>

            <!-- Board Tab (Section 4.4: ุชุฎุชู ฺฉุงุฑุขฺฏุงู) -->
            <div id="boardTab" class="tab-content" style="display:none;">
              <h3 style="color:#2c3e50; border-bottom:3px solid #e74c3c; padding-bottom:10px;">๐ฒ ุชุฎุชู ฺฉุงุฑุขฺฏุงู (Detective's Board - Section 4.4)</h3>
              <p class="subtitle" style="color:#555; margin-bottom:15px;">๐ ุดูุงูุฏ ู ูุชููู ฺฉู ุจู ุชุฎุชู ุงุถุงูู ุดุฏูโุงูุฏ ุฏุฑ ุงูุฌุง ููุงุด ุฏุงุฏู ูโุดููุฏ. ุฎุทูุท ูุฑูุฒ ุงุชุตุงูุงุช ุจู ุขูโูุง ุฑุง ูุดุงู ูโุฏููุฏ.</p>
              
              <div id="boardItems" class="board-container">
                <svg id="boardSvg"></svg>
                <!-- Items will be injected here -->
              </div>

              <div style="margin-top:20px;">
                <h3>ุงุฌุงุฏ ุงุชุตุงู (ุฎุท ูุฑูุฒ)</h3>
                <form id="addConnectionForm" class="form-grid">
                  <select id="fromItem" name="from" required>
                    <option value="">ุงุฒ...</option>
                  </select>
                  <select id="toItem" name="to" required>
                    <option value="">ุจู...</option>
                  </select>
                  <input name="description" placeholder="ุนูุช ุงุชุตุงู" required />
                  <button type="submit">ุงุฌุงุฏ ุงุชุตุงู</button>
                </form>
                <ul id="connectionsList" style="margin-top:15px;"></ul>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script src="{% static 'demo/investigation.js' %}" defer></script>
  </body>
</html>

